分布式锁的基本实现原理

-----

网上的大多文章都提到了分布式锁,要么基于zookeeper实现,要么基于redis实现.
写得好的文章,贴个链接:
http://rdc.gleasy.com/%E4%B8%A4%E7%A7%8D%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%882.html


本文就基于简单的demo来展示他们背后的实现原理

-----

zookeeper有三个实现:
zk. zk2. zk3.



-----
redis 只有一种实现:
/**
*使用Redis实现的分布式锁
*基本工作原理如下：
*1. 使用setnx(key,时间戮+超时)，如果设置成功，则直接拿到锁
*2. 如果设置不成功，获取key的值v1（它的到期时间戮）,跟当前时间对比，看是否已经超时
*3. 如果超时（说明拿到锁的结点已经挂掉)，v2=getset(key,时间戮+超时+1)，判断v2是否等于v1，如果相等，加锁成功，否则加锁失败，等过段时间再重试(200MS)
*/